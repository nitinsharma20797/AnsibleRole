---
- name: Common setup (hostname + /etc/hosts)
  hosts: rabbit_nodes
  become: yes
  vars:
    hosts_map:
      node1: 34.228.55.113
      node2: 13.218.123.143
      node3: 54.208.231.84

  tasks:

    - name: Set hostname
      hostname:
        name: "{{ inventory_hostname }}"

    - name: Update /etc/hosts for RabbitMQ cluster
      blockinfile:
        path: /etc/hosts
        create: yes
        block: |
          {% for host, ip in hosts_map.items() %}
          {{ ip }} {{ host }}
          {% endfor %}
